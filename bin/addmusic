#!/usr/bin/env python

"""Uploads music to tmradio.net"""

import os
import subprocess
import sys
import tempfile

if __name__ == '__main__':
    fn = None
    command = [ 'sftp' ]

    if len(sys.argv) > 1:
        fn = tempfile.mkstemp(prefix='addmusic_', suffix='.txt')[1]
        fp = open(fn, 'wb')
        for item in sys.argv[1:]:
            item = item.replace(' ', '\\ ')
            item = item.replace('"', '\\"')
            item = item.replace("'", "\\'")
            print item
            fp.write('put %s\n' % item)
        fp.close()
        print 'Wrote batch to %s' % fn
        command.append('-b')
        command.append(fn)

    command.append('radio@stream.tmradio.net:/radio/music/incoming')
    subprocess.Popen(command).wait()
    if os.path.exists(fn):
        os.unlink(fn)
    sys.exit(0)
